(this.webpackJsonpbombbeats=this.webpackJsonpbombbeats||[]).push([[0],{24:function(e,t,n){e.exports=n.p+"static/media/RT_Ian_Chang_Kick_1_Drums_Ian_Chang_one_shot.e1d4e232.wav"},25:function(e,t,n){e.exports=n.p+"static/media/RT_Ian_Chang_Tea_Towel_Snare_1_Medium_1_Drums_Ian_Chang_one_shot.bb5dc9f1.wav"},26:function(e,t,n){e.exports=n.p+"static/media/Hat_XL_13.faea9d0d.wav"},28:function(e,t,n){e.exports=n(51)},41:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(13),c=n.n(s),r=n(8),o=n(14),u=n(23),l=n(11),d={TOGGLE_EFFECT:"TOGGLE_EFFECT"};var h=l.default.fromJS({compression:{enabled:!0},distortion:{enabled:!1},highpass:{enabled:!1},lowpass:{enabled:!1}});var m=n(24),f=n.n(m),b=n(25),p=n.n(b),k=n(26),v=n.n(k),g=[{id:0,name:"kick",src:f.a,params:{gain:.4}},{id:1,name:"snare",src:p.a,params:{gain:.6}},{id:2,name:"hat",src:v.a,params:{gain:.2}}];var y=[{key:"NEW",name:"NEW",bpm:120,subdivision:16,sequence:{kick:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],snare:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hat:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{key:"FOUR_ON_THE_FLOOR",name:"4 On The Floor",bpm:112,subdivision:16,sequence:{kick:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],hat:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0]}},{bpm:"116",key:"HIP_HOP",name:"Hip Hop",sequence:{hat:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],kick:[1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},subdivision:16},{bpm:"108",key:"WONKY_ROCK",name:"Wonky Rock",sequence:{hat:[1,0,1,0,0,1,0,1,0,0,1,0,1,0,1,0],kick:[1,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0],snare:[0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0]},subdivision:16},{key:"THREE_AGAINST_FOUR",bpm:"140",name:"3 Against 4",sequence:{hat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],kick:[1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},subdivision:16},{bpm:"220",key:"THRASH",name:"Thrash",sequence:{hat:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],kick:[1,0,1,1,0,0,1,0,1,0,1,0,0,0,1,0],snare:[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},subdivision:16},{key:"EXCUSE_ME",bpm:"300",name:"EXCUSE ME",sequence:{hat:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],kick:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],snare:[0,1,1,0,1,1,1,0,0,0,1,1,1,1,1,1]},subdivision:16}];var C=Object(u.combineReducers)({effects:function(e,t){if("undefined"===typeof e)return h;switch(t.type){case d.TOGGLE_EFFECT:return function(e,t){var n=[t,"enabled"],a=e.getIn(n);return e.setIn(n,!a)}(e,t.effectName);default:return e}},sounds:function(e,t){return"undefined"===typeof e?g:e},beats:function(e,t){return"undefined"===typeof e?y:e}}),T=Object(o.b)(C),E=(n(41),n(4)),S=n(5),O=n(9),P=n(7),q=n(1),j=n(10),_=n(2),N=n.n(_),L=n(27),B=n(18),w=n.n(B);function A(e,t){this.context=e,this.fileList=t,this.bufferList=[],this.loadCount=0}A.prototype.loadBuffer=function(e,t){var n=this;return new w.a((function(a,i){var s=new XMLHttpRequest;s.open("GET",e.src,!0),s.responseType="arraybuffer";var c=n;s.onload=function(){c.context.decodeAudioData(s.response,(function(n){n||i("error decoding file data: "+e.src),c.loadCount++,c.bufferList[t]={name:e.name,buffer:n},a({name:e.name,buffer:n})}),(function(e){i(e)}))},s.onerror=function(e){i(e)},s.send()}))},A.prototype.load=function(){for(var e=[],t=0;t<this.fileList.length;++t)e.push(this.loadBuffer(this.fileList[t],t));return w.a.all(e)};var I=A;var x=750,R=500,F=function(e){for(var t="number"===typeof e?e:50,n=new Float32Array(44100),a=Math.PI/180,i=0;i<44100;i++){var s=2*i/44100-1;n[i]=(3+t)*s*20*a/(Math.PI+t*Math.abs(s))}return n}(33);function M(e){var t=this;e.forEach((function(e){t.trackBuffers[e.name]=e.buffer}))}function G(e,t){var n=e.createBiquadFilter();return n.type=t.type,t.frequency&&n.frequency.setValueAtTime(t.frequency,e.currentTime),n}var H=new(function(){function e(){Object(E.a)(this,e),this.audioCtx=new AudioContext,this.trackBuffers=[],this.masterChannel=[],this.scheduleAudio=this.scheduleAudio.bind(this)}return Object(S.a)(e,[{key:"loadAudio",value:function(e){var t=this;new I(this.audioCtx,e).load().then((function(e){M.call(t,e)})).catch((function(e){console.error(e)}))}},{key:"scheduleAudio",value:function(e,t,n,a){var i=this.audioCtx,s=i.createBufferSource();s.buffer=this.trackBuffers[e],function(e,t,n,a){if(n&&n.gain){var i=t.createGain();i.gain.setValueAtTime(n.gain,t.currentTime),e.connect(i),e=i}if(a&&a.getIn(["compression","enabled"])){var s=function(e){var t=e.createDynamicsCompressor();return t.threshold.setValueAtTime(-50,e.currentTime),t.knee.setValueAtTime(40,e.currentTime),t.ratio.setValueAtTime(12,e.currentTime),t.attack.setValueAtTime(.25,e.currentTime),t.release.setValueAtTime(.67,e.currentTime),t}(t);e.connect(s),e=s}if(a&&a.getIn(["distortion","enabled"])){var c=function(e){var t=e.createWaveShaper();return t.curve=F,t.oversample="4x",t}(t);e.connect(c),e=c}if(a&&a.getIn(["highpass","enabled"])){var r=G(t,{type:"highpass",frequency:x});e.connect(r),e=r}if(a&&a.getIn(["lowpass","enabled"])){var o=G(t,{type:"lowpass",frequency:R});e.connect(o),e=o}return e}(s,i,n,a).connect(i.destination),s.start(t)}},{key:"getCurrentTime",value:function(){return this.audioCtx.currentTime}}]),e}());function D(e,t){return 6e4/e*(4/t)}var K=new(function(e){function t(){var e;return Object(E.a)(this,t),(e=Object(O.a)(this,Object(P.a)(t).call(this))).subdivision=16,e.bpm=128,e.sequenceLength=16,e.startTime=0,e.expectedTime=0,e.actualTime=0,e.isRunning=!1,e.timeoutId=null,e.interval=D(e.bpm,e.subdivision),e.currentStep=0,e.start=e.start.bind(Object(q.a)(e)),e.stop=e.stop.bind(Object(q.a)(e)),e.step=e.step.bind(Object(q.a)(e)),e.setBPM=e.setBPM.bind(Object(q.a)(e)),e.setParams=e.setParams.bind(Object(q.a)(e)),e.getParams=e.getParams.bind(Object(q.a)(e)),e}return Object(j.a)(t,e),Object(S.a)(t,[{key:"start",value:function(){this.isRunning||(this.startTime=H.getCurrentTime(),this.expectedTime=0,this.actualTime=0,this.currentStep=0,this.isRunning=!0,this.emit("start"),this.step())}},{key:"stop",value:function(){this.isRunning=!1,clearTimeout(this.timeoutId),this.emit("stop")}},{key:"step",value:function(){this.actualTime=H.getCurrentTime()-this.startTime;var e=this.actualTime-this.expectedTime;this.timeoutId=setTimeout(this.step,this.interval-e),this.emit("step",this.currentStep),this.currentStep++,this.expectedTime+=this.interval/1e3}},{key:"handleChange",value:function(){this.emit("change",this.getParams())}},{key:"getSequenceLength",value:function(){return this.sequenceLength}},{key:"getParams",value:function(){return{subdivision:this.subdivision,bpm:this.bpm}}},{key:"setBPM",value:function(e){this.bpm=e,this.interval=D(e,this.subdivision),this.handleChange()}},{key:"setParams",value:function(e){this.subdivision=e.subdivision,this.setBPM(e.bpm)}}]),t}(L.EventEmitter));n(44),n(45);var V=function(e){return i.a.createElement("li",{className:N()("TouchPad-container",{active:e.active,disabled:e.disabled}),onClick:e.onClick})};function W(e){return i.a.createElement("ul",{className:"Track-container"},function(e){for(var t=K.getSequenceLength(),n=[],a=0;a<t;a++)n.push(i.a.createElement(V,{key:"touch-pad-".concat(a),active:e.sequence[a],disabled:!e.enabled,onClick:e.onClickTouchPad.bind(null,e.trackname,a)}));return n}(e))}n(46);function U(e){K.setBPM(e.target.value)}function X(e){var t=e.bpm;return i.a.createElement("ul",{className:N()("Controls-container",{active:e.active}),onClick:e.onClick},i.a.createElement("li",{className:N()("play","playback")},i.a.createElement("button",{className:N()("play",{active:e.isPlaying}),onClick:K.start},"play_arrow"),i.a.createElement("button",{className:N()("stop",{active:e.isPlaying}),onClick:K.stop},"stop")),i.a.createElement("li",{className:"bpm-slider-container"},i.a.createElement("input",{className:"bpm-slider",type:"range",value:t,min:10,max:300,onChange:U})),i.a.createElement("li",{className:"bpm-readout"},i.a.createElement("div",null,t)))}n(47);function J(e){return i.a.createElement("div",{className:"Effects-container"},i.a.createElement("button",{className:N()("Effects-compressor",{enabled:e.settings.getIn(["compression","enabled"])}),onClick:function(){e.onClick("compression")}},"compressor"),i.a.createElement("button",{className:N()("Effects-distortion",{enabled:e.settings.getIn(["distortion","enabled"])}),onClick:function(){e.onClick("distortion")}},"distortion"),i.a.createElement("button",{className:N()("Effects-highpass",{enabled:e.settings.getIn(["highpass","enabled"])}),onClick:function(){e.onClick("highpass")}},"high pass"),i.a.createElement("button",{className:N()("Effects-lowpass",{enabled:e.settings.getIn(["lowpass","enabled"])}),onClick:function(){e.onClick("lowpass")}},"low pass"))}n(48);function Y(e){var t=K.getSequenceLength();return i.a.createElement("ul",{className:"RunningLights-container"},function(e,t){for(var n=[],a=0;a<e;a++)n.push(i.a.createElement("div",{key:"running-light-".concat(a),className:N()("RunningLights-light",{active:t.active&&t.currentStep===a})}));return n}(t,e))}n(49);function z(e){var t={};return e.forEach((function(e){t[e.name]=!0})),t}var Q=function(e){function t(e){var n;Object(E.a)(this,t),n=Object(O.a)(this,Object(P.a)(t).call(this,e));var a={bpm:e.beat.bpm,subdivision:e.beat.subdivision},i={beatKey:e.beat.key,enabledTracks:z(e.sounds),sequence:e.beat.sequence,isPlaying:!1,currentStep:0,clockParams:a};return n.state=i,K.setParams(a),n.handleClickTouchPad=n.handleClickTouchPad.bind(Object(q.a)(n)),n.handleClickTrackname=n.handleClickTrackname.bind(Object(q.a)(n)),n.handleClickEffects=n.handleClickEffects.bind(Object(q.a)(n)),n.handleClockStep=n.handleClockStep.bind(Object(q.a)(n)),n.handleClockStart=n.handleClockStart.bind(Object(q.a)(n)),n.handleClockStop=n.handleClockStop.bind(Object(q.a)(n)),n.handleClockParamChange=n.handleClockParamChange.bind(Object(q.a)(n)),n.scheduleSequenceStep=n.scheduleSequenceStep.bind(Object(q.a)(n)),n}return Object(j.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){K.addListener("start",this.handleClockStart),K.addListener("stop",this.handleClockStop),K.addListener("step",this.handleClockStep),K.addListener("change",this.handleClockParamChange),H.loadAudio(this.props.sounds)}},{key:"componentWillUnmount",value:function(){K.stop(),K.removeListener("start",this.handleClockStart),K.removeListener("stop",this.handleClockStop),K.removeListener("step",this.handleClockStep),K.removeListener("change",this.handleClockParamChange)}},{key:"handleClockStart",value:function(){this.setState({isPlaying:!0}),console.log({key:this.state.beatKey,bpm:this.state.clockParams.bpm,subdivision:this.state.clockParams.subdivision,sequence:this.state.sequence})}},{key:"handleClockStop",value:function(){this.setState({isPlaying:!1,currentStep:0})}},{key:"handleClockStep",value:function(e){var t=e%K.getSequenceLength();this.scheduleSequenceStep(t,H.getCurrentTime()),this.setState({currentStep:t})}},{key:"handleClockParamChange",value:function(e){this.setState({clockParams:e})}},{key:"handleClickTrackname",value:function(e){var t=Object.assign({},this.state.enabledTracks);t[e]=!t[e],this.setState({enabledTracks:t})}},{key:"handleClickTouchPad",value:function(e,t){var n=Object.assign({},this.state.sequence);n[e][t]=!n[e][t],this.setState({sequence:n})}},{key:"handleClickEffects",value:function(e){this.props.dispatch(function(e){return{type:d.TOGGLE_EFFECT,effectName:e}}(e))}},{key:"scheduleSequenceStep",value:function(e,t){var n=this;this.props.sounds.forEach((function(a){if(n.state.enabledTracks[a.name]&&n.state.sequence[a.name][e]){var i=Object.assign({},a.params);H.scheduleAudio(a.name,t,i,n.props.effects)}}))}},{key:"renderTracknames",value:function(){var e=this;return this.props.sounds.map((function(t){return i.a.createElement("li",{key:t.id,className:"Sequencer-track-label",onClick:e.handleClickTrackname.bind(e,t.name)},i.a.createElement("button",{className:N()("Sequencer-track-indicator",{active:e.state.enabledTracks[t.name]})}),i.a.createElement("div",{className:"Sequencer-track-name"},t.name))}))}},{key:"renderTracks",value:function(e){var t=this;return this.props.sounds.map((function(n){return i.a.createElement(W,{key:n.id,enabled:t.state.enabledTracks[n.name],trackname:n.name,sequence:e[n.name],onClickTouchPad:t.handleClickTouchPad})}))}},{key:"render",value:function(){var e=this.state,t=e.isPlaying,n=e.currentStep,a=e.sequence,s=this.state.clockParams.bpm,c=this.props.effects;return i.a.createElement("div",{className:"Sequencer"},i.a.createElement(X,{bpm:s,isPlaying:t}),i.a.createElement(J,{settings:c,onClick:this.handleClickEffects}),i.a.createElement(Y,{active:t,currentStep:n}),i.a.createElement("div",{className:"Sequencer-sequencer"},i.a.createElement("ul",{className:"Sequencer-tracklist"},this.renderTracknames()),i.a.createElement("div",{className:"Sequencer-track-container"},this.renderTracks(a))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(e.beat.key!==t.beatKey){t.isPlaying&&K.stop();var n={bpm:e.beat.bpm,subdivision:e.beat.subdivision};t.sequence=e.beat.sequence,t.beatKey=e.beat.key,t.enabledTracks=z(e.sounds),t.clockParams=n,K.setParams(n)}return t}}]),t}(a.Component),Z=Object(r.b)((function(e){return{sounds:e.get("sounds"),effects:e.get("effects")}}))(Q),$=(n(50),function(e){function t(e){var n;return Object(E.a)(this,t),(n=Object(O.a)(this,Object(P.a)(t).call(this,e))).state={selectedBeat:void 0},n.handleBeatSelected=n.handleBeatSelected.bind(Object(q.a)(n)),n}return Object(j.a)(t,e),Object(S.a)(t,[{key:"handleBeatSelected",value:function(e){this.setState({selectedBeat:e.target.value})}},{key:"componentDidMount",value:function(){var e=this.props.beats.map((function(e){return e.key}));this.setState({selectedBeat:e.length>0?e[0]:void 0})}},{key:"renderBeatSelect",value:function(){var e=this.props.beats.map((function(e){return i.a.createElement("option",{key:e.key,value:e.key},e.name)}));return i.a.createElement("select",{value:this.state.selectedBeat,onChange:this.handleBeatSelected,className:"App--beat-select"},e)}},{key:"render",value:function(){var e=this,t=this.props.beats.find((function(t){return t.key===e.state.selectedBeat}));return i.a.createElement("div",{className:"App"},this.renderBeatSelect(),t?i.a.createElement(Z,{beat:t}):null)}}]),t}(a.Component));var ee=Object(r.b)((function(e){return{beats:e.get("beats")}}))($);c.a.render(i.a.createElement(r.a,{store:T},i.a.createElement(ee,null)),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.5e246bc6.chunk.js.map